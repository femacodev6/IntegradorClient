<style>
    .azul {
        background-color: #438eb9;
        color: aliceblue;
        font-size: 20px;
    }

    .verde {
        background-color: #8fc74a;
        color: beige;
        font-size: 20px;
    }

    .border-azul {
        border: 2px solid #438eb9;
    }

    .border-verde {
        border: 2px solid #8fc74a;
    }

    .grupo-label {
        color: black;
        font-weight: bolder;
    }
</style>
<h5 class="m-0">Reporte de permisos</h5>
<p-toolbar styleClass="mb-6">
    <ng-template #start>
        <p-button class="mr-2" label="Mes anterior" (onClick)="setMesAnterior()">
        </p-button>
        <p-button class="mr-2" label="Este mes" (onClick)="setMesActual()">
        </p-button>
        <!-- <p-floatlabel variant="on">
            <p-datepicker [(ngModel)]="fechaInicio" />
            <label for="on_label">Fecha Inicio</label>
        </p-floatlabel>
        <p-floatlabel variant="on">
            <p-datepicker [(ngModel)]="fechaFin" />
            <label for="on_label">Fecha Fin</label>
        </p-floatlabel> -->
        <p-floatlabel class="mr-2 w-60" variant="on">
            <p-datepicker [(ngModel)]="rangeDates" selectionMode="range" [readonlyInput]="true" dateFormat="dd/mm/yy"
                class="w-full" />
            <label for="on_label">Fecha Inicio - Fecha Fin</label>
        </p-floatlabel>
        <!-- <p-select [options]="motivos()" [(ngModel)]="selectedMotivo" placeholder="MOTIVO INNGRESA:" [group]="true"
            class="w-full md:w-56">
            <ng-template let-group pTemplate="group">
                <div class="flex items-center grupo-label">
                    <span>{{ group.label }}</span>
                </div>
            </ng-template>
        </p-select> -->
        <p-button label="Ver permisos" severity="info" class="mr-2" (onClick)="loadDemoData()" />
    </ng-template>
</p-toolbar>

<div class="card" [style]="{'padding':'1em'}">
    <div class="mb-2 flex items-center justify-between flex-wrap">
        <div class="flex items-center flex-wrap gap-2">
            <p-floatlabel variant="on">
                <input pInputText id="on_label" pInputText [(ngModel)]="dniFilter" />
                <label for="on_label">Nombre o Dni</label>
                @if (dniFilter()) {
       <button pButton icon="pi pi-times" class="p-button-text p-button-plain" (click)="dniFilter.set('')"></button>
     }
            </p-floatlabel>
            <p-floatlabel class="w-full md:w-56" variant="on">
                <p-select [options]="tiposPermiso()" [(ngModel)]="tiposPermisoSelected" optionLabel="nombre"
                    optionValue="nombre" [checkmark]="true" [showClear]="true" class="mr-2 w-full md:w-56">
                    <ng-template let-tipoPermiso #item>
                        <span class="mr-2">
                            {{tipoPermiso.nombre}}
                        </span>
                        <p-badge [value]="tipoPermiso.cantidad" severity="secondary" badgeSize="small" />
                    </ng-template>
                </p-select>
                <label for="on_label">Tipo de permiso</label>
            </p-floatlabel>
            <p-floatlabel class="w-full md:w-56" variant="on">
                <p-select [options]="estadosCantidad()" [(ngModel)]="estadosSelected" optionLabel="nombre"
                    optionValue="id" [checkmark]="true" [showClear]="true" class="mr-2 w-full md:w-56">
                    <ng-template let-estado #item>
                        <p-tag [value]="estado.nombre" [severity]="estado.severity" class="mr-2" />
                        <p-badge [value]="estado.cantidad" severity="secondary" badgeSize="small" />
                    </ng-template>
                </p-select>
                <label for="on_label">Inngresa - Buk</label>
            </p-floatlabel>

            <span class="mr-2">{{totalPermisos()}} permisos</span>
        </div>

        <div class="flex items-center space-x-2">
            <p-button label="Traspasar" severity="warn" class="mr-2" (onClick)="permisosToBukVolcar()" />
            <span>{{selectedPermisos?.length || 0}} seleccionados</span>
        </div>
    </div>
    <p-menu #menu [model]="menuItems" [popup]="true"></p-menu>

    <div class="card">
        <p-table [value]="unionTodosBukInntegraFilter()" dataKey="rowIndex" size="small"
            [tableStyle]="{ 'min-width': '60rem' }" showGridlines [(selection)]="selectedPermisos"
            sortField="permiso.inicio" [sortOrder]="1">

            <ng-template #header>
                <tr>
                    <th></th>
                    <th colspan="6" class="azul">Inngresa</th>
                    <th colspan="6" class="verde">Buk</th>
                </tr>
                <tr>
                    <th style="width: 3rem">
                        <p-tableHeaderCheckbox />
                    </th>
                    <th class="azul">DNI</th>
                    <th class="azul">Nombre</th>
                    <th class="azul">Tipo de Permiso</th>
                    <th class="azul" pSortableColumn="permiso.inicio">
                        <div class="flex items-center gap-2">
                            Ini
                            <p-sortIcon field="permiso.inicio" />
                        </div>
                    </th>
                    <!-- <th class="azul">Inicio</th> -->
                    <th class="azul">Fin</th>
                    <th class="azul">Por</th>
                    <!-- buk -->
                    <th class="verde">DNI</th>
                    <th class="verde">Nombre</th>
                    <th class="verde">Tipo de Permiso</th>
                    <th class="verde">Inicio</th>
                    <th class="verde">Fin</th>
                    <th class="verde">Pago</th>
                </tr>
            </ng-template>
            <ng-template #body let-unionTodosBukInntegra>
                <tr>
                    <td style="width: 3rem">
                        <p-tableCheckbox [value]="unionTodosBukInntegra" />
                    </td>
                    <td class="border-azul">
                        <span class="cursor-pointer text-blue-600 hover:underline"
                            (click)="onIdentificacionClick(unionTodosBukInntegra.permiso?.identificacion)">
                            {{ unionTodosBukInntegra.permiso?.identificacion }}
                        </span>
                    </td>
                    <td class="border-azul">{{ unionTodosBukInntegra.permiso?.fullname }}</td>
                    <td class="border-azul"><span [class]="{
  'line-through': unionTodosBukInntegra.permiso?.tipoDePermisoAlternativo(),
  'text-orange-500': unionTodosBukInntegra.estado.id==4,
}">{{ unionTodosBukInntegra.permiso?.tipoDePermiso | sinGuiones }}</span>

                        {{ unionTodosBukInntegra.permiso?.tipoDePermisoAlternativo() | sinGuiones }}
                        @if(!unionTodosBukInntegra.todosBuk()){
                        <div class="flex justify-end">
                            @if(unionTodosBukInntegra.permiso.tipoDePermiso=="compensacion_por_horas_femaco"){
                            <p-button (click)="openMenu($event, unionTodosBukInntegra, menu)"
                                icon="pi pi-arrow-right-arrow-left" size="small" severity="warn" [rounded]="true"
                                variant="text">
                            </p-button>
                            }
                            @if(unionTodosBukInntegra.permiso.tipoDePermiso=="inasistencia"){
                            <p-button (click)="openMenuInasistencia($event, unionTodosBukInntegra, menu)"
                                icon="pi pi-arrow-right-arrow-left" size="small" severity="warn" [rounded]="true"
                                variant="text">
                            </p-button>
                            }
                        </div>
                        }
                    </td>
                    <td class="border-azul">{{ unionTodosBukInntegra.permiso?.inicio | fechaLarga }}
                        @if(unionTodosBukInntegra.permiso && !unionTodosBukInntegra.permiso?.allday){
                        <p-tag [value]="unionTodosBukInntegra.permiso?.inicio | soloHora" severity="info"
                            [rounded]="true" />
                        }
                    </td>
                    <td class="border-azul">{{ unionTodosBukInntegra.permiso?.fin | fechaLarga }}
                        @if(unionTodosBukInntegra.permiso && !unionTodosBukInntegra.permiso?.allday){
                        <p-tag [value]="unionTodosBukInntegra.permiso?.fin | soloHora" severity="info"
                            [rounded]="true" />
                        }
                    </td>
                    <td class="border-azul">{{ unionTodosBukInntegra.permiso? (unionTodosBukInntegra.permiso?.allday?
                        "DÃ­as"
                        : "Horas"): "" }}</td>
                    <!-- buk -->
                    <td class="border-verde">
                        <span class="cursor-pointer text-green-600 hover:underline"
                            (click)="onIdentificacionClick(unionTodosBukInntegra.todosBuk()?.dni)">
                            {{ unionTodosBukInntegra.todosBuk()?.dni }}
                        </span>
                    </td>
                    <td class="border-verde">{{ unionTodosBukInntegra.todosBuk()?.fullname }}</td>
                    <td class="border-verde">
                        <span [class]="{
  'text-orange-500': unionTodosBukInntegra.estado.id==4,
}">
                            {{ bukTipoPermiso(unionTodosBukInntegra.todosBuk()) | sinGuiones }}
                        </span>
                    </td>
                    <td class="border-verde"> {{ unionTodosBukInntegra.todosBuk()?.startDate | fechaLarga }}
                        @if(bukStartTime(unionTodosBukInntegra.todosBuk())){
                        <p-tag [value]="bukStartTime(unionTodosBukInntegra.todosBuk()) | soloHora" severity="info"
                            [rounded]="true" />
                        }
                    </td>
                    <td class="border-verde">{{ unionTodosBukInntegra.todosBuk()?.endDate | fechaLarga }}
                        @if(bukEndTime(unionTodosBukInntegra.todosBuk())){
                        <p-tag [value]="bukEndTime(unionTodosBukInntegra.todosBuk()) | soloHora" severity="info"
                            [rounded]="true" />
                        }
                    </td>
                    <td class="border-verde">{{
                        bukPagado(unionTodosBukInntegra.todosBuk())==null?'':bukPagado(unionTodosBukInntegra.todosBuk())?"Si":"No"
                        }}</td>

                </tr>
            </ng-template>
        </p-table>
    </div>