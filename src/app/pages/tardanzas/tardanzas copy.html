<h5 class="m-0">Reporte de tardanzas</h5>
<p-toolbar styleClass="mb-6">
    <ng-template #start>
        <p-floatlabel variant="on">
            <p-datepicker [(ngModel)]="fechaInicio" />
            <label for="on_label">Fecha Inicio</label>
        </p-floatlabel>
        <p-floatlabel variant="on">
            <p-datepicker [(ngModel)]="fechaFin" />
            <label for="on_label">Fecha Fin</label>
        </p-floatlabel>
        <p-button label="Ver tardanzas" severity="info" class="mr-2"
            (onClick)="loadDemoData()" />
    </ng-template>
</p-toolbar>

<div class="card">
    <p-table [value]="groupedTardanzas()" dataKey="identificacion" [tableStyle]="{ 'min-width': '60rem' }"
        [expandedRowKeys]="expandedRows" showGridlines>
        
        <ng-template #header>
            <tr>
                <th style="width: 3rem">
                    <p-tableHeaderCheckbox />
                </th>
                <th style="width: 5rem"></th>
                <th>Identificacion</th>
                <th>Nombre</th>
                <th>Atrazo</th>
            </tr>
        </ng-template>
        <ng-template #body let-groupedTardanza let-expanded="expanded">
            <tr>
                <td style="width: 3rem">
                    <p-tableCheckbox [value]="tardanza" />
                </td>
                <td>
                    <p-button type="button" pRipple [pRowToggler]="groupedTardanza" [text]="true" severity="secondary"
                        [rounded]="true" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" />
                </td>
                <td>{{ groupedTardanza.identificacion }}</td>
                <td>{{ groupedTardanza.nombre + " " + groupedTardanza.apellidos}}</td>
                <td>{{ groupedTardanza.totalAtraso }}</td>
            </tr>
        </ng-template>
        <ng-template #expandedrow let-groupedTardanza>
            <tr>
                <td colspan="7">
                    <div class="p-4">
                        <p-table #dt [value]="groupedTardanza.tardanzas" showGridlines="false" [rows]="10"
                            [columns]="cols" [paginator]="false"
                            [globalFilterFields]="['name', 'country.name', 'representative.name', 'status']"
                            [tableStyle]="{ 'min-width': '100%' }" [(selection)]="selectedTardanzas" [rowHover]="true"
                            dataKey="id">
                            <ng-template #header>
            <tr>
                <th pSortableColumn="dia">
                    Dia
                    <p-sortIcon field="dia" />
                </th>
                <th pSortableColumn="entrada_real">
                    Entrada real
                    <p-sortIcon field="entrada_real" />
                </th>
                <th pSortableColumn="atraso">
                    Atraso
                    <p-sortIcon field="atraso" />
                </th>
            </tr>
        </ng-template>
        <ng-template #body let-tardanza>
            <tr>
                <td>{{ tardanza.dia }}</td>
                <td>{{ tardanza.entrada_real }}</td>
                <td>{{ tardanza.atraso }}</td>
                
            </tr>
        </ng-template>
    </p-table>
</div>
</td>
</tr>
</ng-template>
</p-table>
</div>
<!-- 
<p-table #dt [value]="tardanzas()" [rows]="10" [columns]="cols" [paginator]="false"
    [globalFilterFields]="['name', 'country.name', 'representative.name', 'status']"
    [tableStyle]="{ 'min-width': '100%' }" [(selection)]="selectedTardanzas" [rowHover]="true" dataKey="id">
    <ng-template #caption>
        <div class="flex items-center justify-between">
            <h5 class="m-0">Reporte de tardanzas</h5>
        </div>
    </ng-template>
    <ng-template #header>
        <tr>
            <th style="width: 3rem">
                <p-tableHeaderCheckbox />
            </th>
            <th pSortableColumn="nombre" style="min-width:16rem">
                Nombre
                <p-sortIcon field="nombre" />
            </th>
            <th pSortableColumn="dia">
                Dia
                <p-sortIcon field="dia" />
            </th>
            <th pSortableColumn="entrada_real">
                Entrada real
                <p-sortIcon field="entrada_real" />
            </th>
            <th pSortableColumn="atraso">
                Atraso
                <p-sortIcon field="atraso" />
            </th>
            <th style="min-width: 12rem"></th>
        </tr>
    </ng-template>
    <ng-template #body let-tardanza>
        <tr>
            <td style="width: 3rem">
                <p-tableCheckbox [value]="tardanza" />
            </td>
            <td style="min-width: 16rem">{{ tardanza.nombre }}</td>
            <td>{{ tardanza.dia }}</td>
            <td>{{ tardanza.entrada_real }}</td>
            <td>{{ tardanza.atraso }}</td>
            <td>
                <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true"
                    (click)="editTardanza(tardanza)" />
                <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true"
                    (click)="deleteTardanza(tardanza)" />
            </td>
        </tr>
    </ng-template>
</p-table> -->

<p-dialog [(visible)]="tardanzaDialog" [style]="{ width: '450px' }" header="Tardanza Details" [modal]="true">
    <ng-template #content>
        <div class="flex flex-col gap-6">
            <img [src]="'https://primefaces.org/cdn/primeng/images/demo/tardanza/' + tardanza.image"
                [alt]="tardanza.image" class="block m-auto pb-4" *ngIf="tardanza.image" />
            <div>
                <label for="name" class="block font-bold mb-3">Name</label>
                <input type="text" pInputText id="name" [(ngModel)]="tardanza.name" required autofocus fluid />
                <small class="text-red-500" *ngIf="submitted && !tardanza.name">Name is required.</small>
            </div>
            <div>
                <label for="description" class="block font-bold mb-3">Description</label>
                <textarea id="description" pTextarea [(ngModel)]="tardanza.description" required rows="3" cols="20"
                    fluid></textarea>
            </div>

            <div>
                <label for="inventoryStatus" class="block font-bold mb-3">Inventory Status</label>
                <p-select [(ngModel)]="tardanza.inventoryStatus" inputId="inventoryStatus" [options]="statuses"
                    optionLabel="label" optionValue="label" placeholder="Select a Status" fluid />
            </div>

            <div>
                <span class="block font-bold mb-4">Category</span>
                <div class="grid grid-cols-12 gap-4">
                    <div class="flex items-center gap-2 col-span-6">
                        <p-radiobutton id="category1" name="category" value="Accessories"
                            [(ngModel)]="tardanza.category" />
                        <label for="category1">Accessories</label>
                    </div>
                    <div class="flex items-center gap-2 col-span-6">
                        <p-radiobutton id="category2" name="category" value="Clothing"
                            [(ngModel)]="tardanza.category" />
                        <label for="category2">Clothing</label>
                    </div>
                    <div class="flex items-center gap-2 col-span-6">
                        <p-radiobutton id="category3" name="category" value="Electronics"
                            [(ngModel)]="tardanza.category" />
                        <label for="category3">Electronics</label>
                    </div>
                    <div class="flex items-center gap-2 col-span-6">
                        <p-radiobutton id="category4" name="category" value="Fitness" [(ngModel)]="tardanza.category" />
                        <label for="category4">Fitness</label>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-12 gap-4">
                <div class="col-span-6">
                    <label for="price" class="block font-bold mb-3">Price</label>
                    <p-inputnumber id="price" [(ngModel)]="tardanza.price" mode="currency" currency="USD" locale="en-US"
                        fluid />
                </div>
                <div class="col-span-6">
                    <label for="quantity" class="block font-bold mb-3">Quantity</label>
                    <p-inputnumber id="quantity" [(ngModel)]="tardanza.quantity" fluid />
                </div>
            </div>
        </div>
    </ng-template>

    <ng-template #footer>
        <p-button label="Cancel" icon="pi pi-times" text (click)="hideDialog()" />
        <p-button label="Save" icon="pi pi-check" (click)="saveTardanza()" />
    </ng-template>
</p-dialog>

<p-confirmdialog [style]="{ width: '450px' }" />