<style>
  .feriado {
    background-color: #ff8585;
}
  .gris {
    background-color: #5a5a5a;
    color: aliceblue;
    font-size: 15px;
}
.border-gris {
  border: 2px solid #303030;
}
  .rojo {
    background-color: #b94343;
    color: aliceblue;
    font-size: 15px;
}
.border-rojo {
  border: 2px solid #b52214;
}
  .azul {
    background-color: #438eb9;
    color: aliceblue;
    font-size: 15px;
  }
  .verde {
    background-color: #8fc74a;
    color: beige;
    font-size: 15px;
  }
  .border-azul {
    border: 2px solid #438eb9;
  }
  .border-verde {
    border: 2px solid #8fc74a;
  }
</style>
<h5 class="m-0">Reporte de horasExtras</h5>
<p-toolbar styleClass="mb-6">
    <ng-template #start>
        <p-button class="mr-2" label="Mes anterior" (onClick)="setMesAnterior()">
        </p-button>
        <p-button class="mr-2" label="Este mes" (onClick)="setMesActual()">
        </p-button>
        <p-floatlabel variant="on" class="mr-2">
            <p-datepicker [(ngModel)]="fechaInicio" />
            <label for="on_label">Fecha Inicio</label>
        </p-floatlabel>
        <p-floatlabel variant="on" class="mr-2">
            <p-datepicker [(ngModel)]="fechaFin" />
            <label for="on_label">Fecha Fin</label>
        </p-floatlabel>
        <p-button label="Ver horasExtras" severity="info" class="mr-2" (onClick)="loadDemoData()" />

    </ng-template>
</p-toolbar>

<div class="card" [style]="{'padding':'1em'}">
    <div class="mb-2 flex items-center justify-between flex-wrap">
        <!-- izquierda: selects y total -->
        <div class="flex items-center flex-wrap gap-2">
            <!-- <p-select [options]="turnos()" [(ngModel)]="turnoSelected" optionLabel="nombre" optionValue="nombre"
                [checkmark]="true" [showClear]="true" placeholder="Selecione un turno" class="mr-2 w-full md:w-56">
                <ng-template let-turno #item>
                    <span class="mr-2">
                        {{turno.nombre}}
                    </span>
                    <p-badge [value]="turno.cantidad" severity="secondary" badgeSize="small" />
                </ng-template>
            </p-select>

            <p-select [options]="comparacionsCantidad()" [(ngModel)]="comparacionSelected" optionLabel="nombre"
                optionValue="id" [checkmark]="true" [showClear]="true" placeholder="Selecione una comparación"
                class="mr-2 w-full md:w-56">
                <ng-template let-comparacion #item>
                    <p-tag [value]="comparacion.nombre" [severity]="comparacion.severity" class="mr-2" />
                    <p-badge [value]="comparacion.cantidad" severity="secondary" badgeSize="small" />
                </ng-template>
            </p-select> -->

            <!-- <span class="mr-2">{{totalColaboradores()}} colaboradores</span> -->
        </div>

        <!-- derecha: botón y contador alineados a la derecha -->
        <!-- <div class="flex items-center space-x-2">
            @if(isInicioFinMes()==true){
            <p-button label="Traspasar" severity="warn" class="mr-2" (onClick)="atrazoToBukVolcar()" />
            <span>{{selectedHorasExtras?.length || 0}} seleccionados</span>
            }
        </div> -->
    </div>

    <p-table [value]="horasExtrasGrupo()" dataKey="identificacion" [tableStyle]="{ 'min-width': '60rem' }"
        [expandedRowKeys]="expandedRows" showGridlines [(selection)]="selectedHorasExtras">

        <ng-template #header>
            <tr>
                <th style="width: 5rem"></th>
                <th style="width: 3rem">
                    <p-tableHeaderCheckbox />
                </th>
                <th pSortableColumn="identificacion">
                    <div class="flex items-center gap-2">
                        Identifi.
                        <p-sortIcon field="identificacion" />
                    </div>
                </th>
                <th pSortableColumn="nombre">
                    <div class="flex items-center gap-2">
                        Nombre
                        <p-sortIcon field="nombre" />
                    </div>
                </th>
                <th pSortableColumn="apellidos">
                    <div class="flex items-center gap-2">
                        Apellidos
                        <p-sortIcon field="apellidos" />
                    </div>
                </th>
                <th class="rojo" pSortableColumn="descartadas">
                    <div class="flex items-center gap-2">
                        Desc.
                        <p-sortIcon field="descartadas" />
                    </div>
                </th>
                <th class="gris" pSortableColumn="paraCompensar">
                    <div class="flex items-center gap-2">
                        Comp.
                        <p-sortIcon field="paraCompensar" />
                    </div>
                </th>
                <th class="azul" pSortableColumn="25">
                    <div class="flex items-center gap-2">
                        25 %
                        <p-sortIcon field="25" />
                    </div>
                </th>
                <th class="azul" pSortableColumn="25">
                    <div class="flex items-center gap-2">
                        35 %
                        <p-sortIcon field="25" />
                    </div>
                </th>
                <th class="azul" pSortableColumn="25">
                    <div class="flex items-center gap-2">
                        100 %
                        <p-sortIcon field="25" />
                    </div>
                </th>
                <th class="verde" pSortableColumn="25">
                    <div class="flex items-center gap-2">
                        25 %
                        <p-sortIcon field="25" />
                    </div>
                </th>
                <th class="verde" pSortableColumn="25">
                    <div class="flex items-center gap-2">
                        35 %
                        <p-sortIcon field="25" />
                    </div>
                </th>
                <th class="verde" pSortableColumn="25">
                    <div class="flex items-center gap-2">
                        100 %
                        <p-sortIcon field="25" />
                    </div>
                </th>
            </tr>
        </ng-template>
        <ng-template #body let-groupedHorasExtra let-expanded="expanded">
            <tr>
                <td>
                    <p-button type="button" pRipple [pRowToggler]="groupedHorasExtra" [text]="true" severity="secondary"
                        [rounded]="true" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" />
                </td>
                <td style="width: 3rem">
                    <p-tableCheckbox [value]="groupedHorasExtra" />
                </td>
                <td>{{ groupedHorasExtra.identificacion }}</td>
                <td>{{ groupedHorasExtra.nombre}}</td>
                <td>{{ groupedHorasExtra.apellidos}}</td>
                <td class="border-rojo">{{ groupedHorasExtra.totales.descartadas | timeToFriendly}}</td>
                <td class="border-gris">{{ groupedHorasExtra.totales.paraCompensar | timeToFriendly}}</td>
                <td class="border-azul">{{ groupedHorasExtra.totales.pagadas25 | timeToFriendly }}</td>
                <td class="border-azul">{{ groupedHorasExtra.totales.pagadas35 | timeToFriendly  }}</td>
                <td class="border-azul">{{ groupedHorasExtra.totales.pagadas100 | timeToFriendly  }}</td>
                <td class="border-verde">{{ groupedHorasExtra.pagadas25Buk | hoursToFriendlyVacum }}</td>
                <td class="border-verde">{{ groupedHorasExtra.pagadas35Buk | hoursToFriendlyVacum }}</td>
                <td class="border-verde">{{ groupedHorasExtra.pagadas100Buk | hoursToFriendlyVacum }}</td>
            
            </tr>
        </ng-template>
        <ng-template #expandedrow let-groupedHorasExtra let-rowIndex="rowIndex">
            <tr>
                <td colspan="13">
                    <div class="p-4">
                        <p-table #dt [value]="groupedHorasExtra.horasExtras" showGridlines="false" [rows]="10"
                            [columns]="cols" [paginator]="false"
                            [globalFilterFields]="['name', 'country.name', 'representative.name', 'status']"
                            [tableStyle]="{ 'min-width': '100%' }" [(selection)]="selectedHorasExtras" [rowHover]="true"
                            dataKey="id">
                            <ng-template #header>
            <tr>
                <th pSortableColumn="dia">
                    Dia
                    <p-sortIcon field="dia" />
                </th>
                <th class="rojo" pSortableColumn="entrada">
                    Desc.
                    <p-sortIcon field="entrada" />
                </th>
                <th class="gris" pSortableColumn="entrada_real">
                    Comp.
                    <p-sortIcon field="entrada_real" />
                </th>
                <th class="azul" pSortableColumn="atraso">
                    25%
                    <p-sortIcon field="atraso" />
                </th>
                <th class="azul" pSortableColumn="atraso">
                    35%
                    <p-sortIcon field="atraso" />
                </th>
                <th class="azul" pSortableColumn="atraso">
                    100%
                    <p-sortIcon field="atraso" />
                </th>
                <th pSortableColumn="atraso">
                    Obs.
                    <p-sortIcon field="atraso" />
                </th>
            </tr>
        </ng-template>
        <ng-template #body let-horasExtra>
            <tr>
                <td [class]="isHolidayOrSunday(horasExtra.dia)?'feriado':''">{{ horasExtra.dia }}</td>
                <td class="border-rojo">{{ horasExtra.revision.descartadas | timeToFriendly }}</td>
                <td class="border-gris">{{ horasExtra.revision.paraCompensar | timeToFriendly }}</td>
                <td class="border-azul">{{ horasExtra.revision.pagadas25 | timeToFriendly }}</td>
                <td class="border-azul">{{ horasExtra.revision.pagadas35 | timeToFriendly }}</td>
                <td class="border-azul">{{ horasExtra.revision.pagadas100 | timeToFriendly }}</td>
                <td>{{ horasExtra.revision.observaciones }}</td>

            </tr>
        </ng-template>
    </p-table>
</div>

@if(isInicioFinMes()==true){
<div class="p-4" style="display: flex; flex-direction: column;">
    <div style="flex: 1;">

    </div>
    <div style="display: flex; justify-content: flex-end;">
        <!-- <p-button label="Traspasar" severity="warn" class="mr-2" (onClick)="atrazoToBuk(rowIndex,groupedHorasExtra)" /> -->
    </div>
</div>
}
</td>
</tr>
</ng-template>
</p-table>
</div>